$(() => {
  var messages = {
    "12": "UI_status",
    "17": "RCM_collision",
    "60": "GTW_info",
    "62": "GTW_alertMatrix",
    "79": "UI_locationStatus",
    "257": "RCM_inertial1",
    "258": "VCLEFT_doorStatus",
    "259": "VCRIGHT_doorStatus",
    "264": "DI_torque",
    "273": "GTW_adc",
    "274": "GTW_adc1",
    "275": "GTW_adc2",
    "276": "GTW_adc3",
    "280": "DI_systemStatus",
    "281": "GTW_busLoadInfo",
    "289": "RCM_nearDeploy",
    "291": "UI_alertMatrix1",
    "297": "SCCM_steeringAngleSensor",
    "306": "BMS_hvBusStatus",
    "307": "UI_presentPhoneKeysOSInfo",
    "325": "ESP_status",
    "371": "UI_presentPhoneKey3Info",
    "390": "DIS_torque",
    "392": "DIS_capability2",
    "435": "UI_presentPhoneKey2Info",
    "473": "VCSEC_IsoTpUDPPipeUI",
    "499": "UI_presentPhoneKey1Info",
    "505": "VCSEC_requests",
    "516": "PCS_chgStatus",
    "522": "HVP_contactorState",
    "523": "TAS_heights",
    "524": "VCRIGHT_hvacRequest",
    "525": "TAS_states",
    "526": "PARK_sdiFront",
    "528": "CP_status",
    "529": "RCM_status",
    "530": "BMS_status",
    "531": "UI_cruiseControl",
    "532": "FC_status",
    "533": "FC_status2",
    "535": "FC_status3",
    "536": "UI_driverAssistRoadSign",
    "541": "CP_evseStatus",
    "542": "PARK_pscStatus",
    "545": "VCFRONT_LVPowerState",
    "548": "PCS_dcdcStatus",
    "552": "EPBR_internalStatus",
    "558": "PARK_sdiRear",
    "568": "UI_driverAssistMapData",
    "569": "DAS_lanes",
    "573": "CP_chargeStatus",
    "577": "VCFRONT_coolant",
    "579": "VCRIGHT_hvacFeedback",
    "580": "FC_limits",
    "583": "DAS_autopilotDebug",
    "585": "SCCM_leftStalk",
    "586": "DAS_visualDebug",
    "590": "PARK_pscVehSlot",
    "594": "BMS_powerAvailable",
    "595": "UI_ventPanelControlRequest",
    "599": "DI_speed",
    "600": "APB_status",
    "601": "APP_status",
    "606": "PARK_pscEnvSlot",
    "609": "VCFRONT_12VBatteryStatus",
    "610": "VCLEFT_steeringColumnStatus",
    "611": "VCRIGHT_logging10Hz",
    "612": "PCS_chgLineStatus",
    "614": "DI_power",
    "616": "DI_systemPower",
    "626": "VCLEFT_epbmDebug",
    "627": "UI_vehicleControl",
    "632": "UI_roadCurvature",
    "637": "APS_eacMonitor",
    "642": "VCLEFT_hvacBlowerFeedback",
    "644": "UI_vehicleModes",
    "645": "UI_driverProfileRecall",
    "646": "DI_locStatus",
    "647": "PTC_sensorStatus",
    "648": "EPBL_internalStatus",
    "658": "BMS_socStatus",
    "659": "UI_chassisControl",
    "664": "UI_csaOfframpCurvature",
    "676": "PCS_thermalStatus",
    "679": "UI_csaRoadCurvature",
    "681": "EPBL_status",
    "690": "BMS_chargerRequest",
    "691": "VCRIGHT_logging1Hz",
    "694": "DI_chassisControlStatus",
    "697": "DAS_control",
    "698": "UI_radarMapData",
    "705": "VCFRONT_logging10Hz",
    "708": "PCS_logging",
    "721": "VCFRONT_okToUseHighPower",
    "722": "BMS_driveLimits",
    "723": "UI_solarData",
    "737": "VCFRONT_status",
    "741": "DIS_power",
    "744": "EPBR_status",
    "753": "VCFRONT_eFuseDebugStatus",
    "754": "BMS_vehNm",
    "755": "UI_hvacRequest",
    "768": "BMS_info",
    "769": "VCFRONT_info",
    "770": "VCLEFT_info",
    "771": "OCS1P_status",
    "772": "PM_alertMatrix1",
    "774": "VCRIGHT_info",
    "777": "DAS_object",
    "778": "VCLEFT_restraintStatus",
    "782": "PARK_status2",
    "784": "HVP_info",
    "785": "EPAS3S_info",
    "786": "BMS_thermalStatus",
    "787": "UI_powertrainControl",
    "789": "OCS1P_info",
    "790": "PM_info",
    "793": "VCSEC_info",
    "794": "VCRIGHT_restraintStatus",
    "796": "CC_chgStatus",
    "797": "CC_chgStatus2",
    "798": "CP_alertMatrix",
    "799": "PARK_status",
    "800": "BMS_alertMatrix",
    "801": "VCFRONT_sensors",
    "802": "TPMS_data",
    "805": "FC_alertMatrix1",
    "806": "PARK_info",
    "808": "ESP_info",
    "809": "APP_warningMatrix0",
    "810": "DAS_warningMatrix0",
    "811": "APS_warningMatrix0",
    "812": "CC_logData",
    "813": "IBST_info",
    "814": "PARK_sensorStatusFront",
    "815": "SCM_alertMatrix1",
    "816": "SCCM_info",
    "817": "EPAS3P_info",
    "818": "BMS_bmbMinMax",
    "819": "UI_chargeRequest",
    "821": "DIS_info",
    "822": "DI_maxRatedPower",
    "824": "UMC_alertMatrix1",
    "825": "VCSEC_authentication",
    "830": "PARK_sensorStatusRear",
    "831": "FC_alertMatrix2",
    "832": "VCFRONT_alertMatrix",
    "837": "PTC_info",
    "840": "GTW_status",
    "841": "DAS_warningMatrix2",
    "845": "TAS_warningMatrix1",
    "846": "PARK_pasFrontMiddle",
    "848": "APS_warningMatrix3",
    "849": "RCM_info",
    "850": "BMS_energyStatus",
    "854": "DI_alertMatrix1",
    "855": "DI_alertMatrix2",
    "856": "UI_tpmsMode",
    "857": "VCSEC_BLEDeviceStatus",
    "858": "DI_alertMatrix3",
    "859": "DI_alertMatrix4",
    "861": "IBST_alertMatrix",
    "862": "PARK_pasRearMiddle",
    "864": "VCLEFT_alertMatrix",
    "867": "CMP_info",
    "869": "SCS_alertMatrix1",
    "872": "GTW_updateStatus",
    "873": "APP_warningMatrix1",
    "874": "DAS_warningMatrix1",
    "876": "APS_warningMatrix1",
    "877": "TAS_warningMatrix2",
    "879": "TPMS_StatusC",
    "880": "SCS_alertMatrix2",
    "881": "RCM_alertMatrix",
    "882": "EPAS3S_sysStatus",
    "883": "EPAS3P_sysStatus",
    "886": "DI_temperature",
    "888": "GTW_ECall",
    "890": "DAS_telemetryPeriodic",
    "894": "PARK_warningMatrix",
    "895": "FC_alertMatrix3",
    "897": "VCFRONT_logging1Hz",
    "899": "VCRIGHT_thsStatus",
    "900": "PMS_alertMatrix1",
    "904": "GTW_canStatus",
    "905": "DAS_status2",
    "909": "TAS_warningMatrix3",
    "913": "EPAS3S_alertMatrix",
    "914": "EPAS3P_alertMatrix",
    "915": "VCRIGHT_epbmDebug",
    "917": "OCS1P_alertMatrix",
    "918": "DI_oilPump",
    "921": "DAS_status",
    "925": "IBST_status",
    "926": "PARK_pasSides",
    "927": "FC_alertMatrix4",
    "929": "VCFRONT_vehicleStatus",
    "930": "VCLEFT_status",
    "932": "PCS_alertMatrix",
    "933": "DIS_alertMatrix1",
    "937": "DAS_telemetry",
    "938": "HVP_alertMatrix1",
    "941": "TAS_warningMatrix4",
    "945": "DAS_telemetryFurniture",
    "947": "UI_vehicleControl2",
    "949": "DIS_alertMatrix2",
    "950": "DI_odometerStatus",
    "952": "UI_tpmsRCPsetting",
    "953": "VCSEC_IsoTpPipeODIN",
    "958": "FC_alertMatrix5",
    "960": "VCRIGHT_alertMatrix",
    "962": "VCLEFT_switchStatus",
    "964": "PCS_info",
    "965": "DIS_alertMatrix3",
    "968": "EPBL_alertMatrix",
    "969": "VCSEC_BLEEndpointInfo",
    "970": "APS_status",
    "973": "TAS_warningMatrix5",
    "978": "BMS_kwhCounter",
    "979": "UI_airbagCutoffStatus",
    "981": "ESP_alertMatrix",
    "984": "UI_elevationStatus",
    "985": "UI_gpsVehicleSpeed",
    "986": "DAS_telemetryEvent",
    "990": "FC_alertMatrix6",
    "994": "VCLEFT_lightStatus",
    "995": "VCRIGHT_lightStatus",
    "997": "DIS_alertMatrix4",
    "1000": "EPBR_alertMatrix",
    "1001": "DAS_bodyControls",
    "1009": "VCFRONT_lighting",
    "1010": "BMS_kwhCountersMultiplexed",
    "1011": "UI_odo",
    "1012": "APP_camCalibrationStatus",
    "1016": "UI_driverAssistControl",
    "1017": "VCSEC_alertMatrix",
    "1018": "APP_cameraLux",
    "1019": "UI_autopilotControl",
    "1020": "APP_boardTemperatures",
    "1022": "DI_estimatedBrakeTemp",
    "1040": "APP_cameraStatus",
    "1064": "UI_telemetryControl",
    "1065": "APP_warningMatrix2",
    "1080": "GTW_ethNm",
    "1081": "APP_warningMatrix3",
    "1082": "DAS_warningMatrix3",
    "1096": "UI_driverAssistAnonDebugParams",
    "1097": "APP_warningMatrix4",
    "1112": "GTW_vehNm",
    "1113": "APS_warningMatrix2",
    "1132": "CC_alertMatrix1",
    "1139": "UI_ethNm",
    "1152": "ODIN_IsoTpPipeVCSEC",
    "1153": "UI_IsoTpUDPPipeVCSEC",
    "1250": "VCLEFT_seatStatus",
    "1251": "VCRIGHT_seatStatus",
    "1280": "UI_debugECU",
    "1282": "RADC_alertMatrix0",
    "1303": "FC_identifier",
    "1310": "FC_info",
    "1323": "GTW_diskioErr",
    "1329": "RADC_info",
    "1337": "DAS_info",
    "1342": "CP_info",
    "1345": "FC_maxLimits",
    "1353": "APP_info",
    "1355": "SCM_alertMatrix2",
    "1357": "TAS_info",
    "1359": "SCCM_alertMatrix",
    "1367": "DI_thermalControl",
    "1376": "GTW_factoryEcuPresent",
    "1519": "TPMS_info",
    "1523": "UI_alertLog",
    "1536": "UDS_vcfrontRequest",
    "1537": "VCFRONT_udsResponse",
    "1538": "UDS_bmsRequest",
    "1539": "UDS_cmpRequest",
    "1540": "UDS_pmRequest",
    "1541": "UDS_disRequest",
    "1542": "UDS_diRequest",
    "1544": "UDS_vcrightRequest",
    "1545": "VCRIGHT_udsResponse",
    "1546": "UDS_vcsecRequest",
    "1547": "VCSEC_udsResponse",
    "1548": "DAS_telemetryRadar",
    "1550": "UDS_cpRequest",
    "1551": "UDS_thcRequest",
    "1552": "UDS_hvpRequest",
    "1553": "HVP_udsResponse",
    "1554": "BMS_udsResponse",
    "1555": "CMP_udsResponse",
    "1556": "PM_udsResponse",
    "1557": "DIS_udsResponse",
    "1558": "DI_udsResponse",
    "1566": "CP_udsResponse",
    "1570": "UDS_vcleftRequest",
    "1571": "VCLEFT_udsResponse",
    "1572": "UDS_epblRequest",
    "1573": "EPBL_udsResponse",
    "1574": "UDS_epbrRequest",
    "1575": "EPBR_udsResponse",
    "1576": "UDS_pcsRequest",
    "1577": "PCS_udsResponse",
    "1579": "UDS_ccRequest",
    "1584": "UDS_epas3pRequest",
    "1592": "EPAS3P_udsResponseCH",
    "1601": "UDS_rcmRequest",
    "1603": "UDS_ocs1pRequest",
    "1604": "UDS_pmsRequest",
    "1605": "UDS_espRequest",
    "1609": "UDS_dasRequest",
    "1611": "UDS_tasRequest",
    "1613": "UDS_ibstRequest",
    "1614": "UDS_parkRequest",
    "1615": "UDS_tpmsRequest",
    "1617": "RCM_udsResponse",
    "1619": "OCS1P_udsResponse",
    "1620": "PMS_udsResponse",
    "1621": "ESP_udsResponse",
    "1622": "DI_info",
    "1625": "DAS_udsResponse",
    "1627": "TAS_udsResponse",
    "1629": "IBST_udsResponse",
    "1630": "PARK_udsResponse",
    "1631": "TPMS_udsResponse",
    "1641": "UDS_KOSTIAsccmRequest",
    "1649": "UDS_radcRequest",
    "1664": "UDS_sccmRequest",
    "1665": "RADC_udsResponse",
    "1680": "SCCM_udsResponse",
    "1734": "UDS_ptcRequest",
    "1748": "PMS_info",
    "1750": "PTC_udsResponse",
    "1795": "VCRIGHT_debugThermal10Hz",
    "1840": "UDS_epas3sRequest",
    "1848": "EPAS3S_udsResponse",
    "1859": "VCRIGHT_recallStatus",
    "1860": "VCLEFT_recallStatus",
    "1879": "DI_debug",
    "1880": "DI_dyno",
    "1885": "CP_sensorData",
    "1898": "HVP_vehicleDbg",
    "1962": "HVP_debugMessage",
    "1992": "EPBL_info",
    "2015": "UDS_functionalRequest",
    "2024": "EPBR_info",
    "2033": "GTW_hrl",
    "2047": "GTW_carConfig"
  }

  var paused = false

  var m2 = new WebSocket(`wss://${location.host}/m2?pin=${window.pin}`)
  m2.binaryType = 'arraybuffer'
  m2.addEventListener('open', (event) => {
    $("#connection").removeClass('red').addClass('green')
  })
  // m2.addEventListener('error', (event) => {
  //   log.unshift(`WebSocket error: ${JSON.stringify(event)}`)
  //   $('#log').text(log.join('\n'))
  // })
  m2.addEventListener('close', (event) => {
    $("#connection").removeClass('green').addClass('red')
  })
  m2.addEventListener('message', (event) => {
    var data = String.fromCharCode.apply(null, new Uint8Array(event.data))
    data.split('\n').forEach(msg => {
      const parts = /(\d+) - (.+) [S|X] 0 (\d+) (.+)/.exec(msg)
      if (!parts) {
        return console.log(parts)
      }
      const ts = parseInt(parts[1])
      const id = parseInt(parts[2], 16)
      const len = parseInt(parts[3])
      const data = parts[4]

      const message = messages[id] || `${id}|0x${id.toString(16)}`
      const output = `${message} @ ${ts} len ${len} | ${data}`

      if (!paused) {
        $msg = $(`#msg${id}`)
        if ($msg.length == 0) {
          $(`<div id="msg${id}">${output}</div>'`).appendTo('#log')
        } else {
          $msg.text(output)
        }
      }
      // console.log(output)

      // log[id] = output
      // if (!paused) {
      //   $('#log').text(log.join('\n'))
      // }
    })
  })

  $('#resume').click(() => {
    paused = false
  })

  $('#pause').click(() => {
    paused = true
  })
})
